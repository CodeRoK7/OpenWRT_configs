#!/bin/sh

checkPackageAndInstall()
{
    local name="$1"
    local isRequried="$2"
    #проверяем установлени ли библиотека $name
    if opkg list-installed | grep -q $name; then
        echo "$name already installed..."
    else
        echo "$name not installed. Installed $name..."
        opkg install $name
		res=$?
		if [ "$isRequried" = "1" ]; then
			if [ $res -eq 0 ]; then
				echo "$name insalled successfully"
			else
				echo "Error installing $name. Please, install $name manually and run the script again"
				exit 1
			fi
		fi
    fi
}

echo "opkg update"
opkg update

checkPackageAndInstall "coreutils-base64" "1"

encoded_code="IyEvYmluL3NoCgp3aGlsZSB0cnVlOyBkbwoJcHJpbnRmICJcMDMzWzMyOzFtQ2hvaWNlIHJ1biBzY3JpcHQsIDEgLSBjb25maWd1cmVfemFwcmV0cywgMiAtIGF3Z19jb25maWcsIDMgLSBhd2dfb3BlcmFfY29uZmlnLCA0IC0gYXdnX29wZXJhX2NvbmZpZ19ub19jaGVja19pbnN0YWxsX2F3ZywgNSAtIHVuaXZlcnNhbF9jb25maWcsIDYgLSB1bml2ZXJzYWxfY29uZmlnX25ldywgNyAtIHVuaXZlcnNhbF9jb25maWdfbmV3X3BvZGtvcCwgOCAtIGF3Z19hdXRvX3NldHVwIDAgLSBleGl0OiBcMDMzWzBtIgoJcmVhZCBjaG9pY2UKCWNhc2UgJGNob2ljZSBpbgoJMSkKCQllY2hvICJSdW5uaWcgc2NyaXB0IGNvbmZpZ3VyZV96YXByZXRzLi4uIgoJCXdnZXQgLS1uby1jaGVjay1jZXJ0aWZpY2F0ZSAtTyAvdG1wL2NvbmZpZ3VyZV96YXByZXRzLnNoIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Db2RlUm9LNy9PcGVuV1JUX2NvbmZpZ3MvcmVmcy9oZWFkcy9tYWluL2NvbmZpZ3VyZV96YXByZXRzLnNoICYmIGNobW9kICt4IC90bXAvY29uZmlndXJlX3phcHJldHMuc2ggJiYgL3RtcC9jb25maWd1cmVfemFwcmV0cy5zaAoJCWJyZWFrCgkJOzsKCgkyKQoJCWVjaG8gIlJ1bm5pZyBzY3JpcHQgYXdnX2NvbmZpZy4uLiIKCQl3Z2V0IC0tbm8tY2hlY2stY2VydGlmaWNhdGUgLU8gL3RtcC9hd2dfY29uZmlnLnNoIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Db2RlUm9LNy9PcGVuV1JUX2NvbmZpZ3MvcmVmcy9oZWFkcy9tYWluL2F3Z19jb25maWcuc2ggJiYgY2htb2QgK3ggL3RtcC9hd2dfY29uZmlnLnNoICYmIC90bXAvYXdnX2NvbmZpZy5zaAoJCWJyZWFrCgkJOzsKCTMpCgkJZWNobyAiUnVubmlnIHNjcmlwdCBhd2dfb3BlcmFfY29uZmlnLi4uIgoJCXdnZXQgLS1uby1jaGVjay1jZXJ0aWZpY2F0ZSAtTyAvdG1wL2F3Z19vcGVyYV9jb25maWcuc2ggaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0NvZGVSb0s3L09wZW5XUlRfY29uZmlncy9yZWZzL2hlYWRzL21haW4vYXdnX29wZXJhX2NvbmZpZy5zaCAmJiBjaG1vZCAreCAvdG1wL2F3Z19vcGVyYV9jb25maWcuc2ggJiYgL3RtcC9hd2dfb3BlcmFfY29uZmlnLnNoCgkJYnJlYWsKCQk7OwoJNCkKCQllY2hvICJSdW5uaWcgc2NyaXB0IGF3Z19vcGVyYV9jb25maWcuLi4iCgkJd2dldCAtLW5vLWNoZWNrLWNlcnRpZmljYXRlIC1PIC90bXAvYXdnX29wZXJhX2NvbmZpZ19ub19jaGVja19pbnN0YWxsX2F3Zy5zaCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQ29kZVJvSzcvT3BlbldSVF9jb25maWdzL3JlZnMvaGVhZHMvbWFpbi9hd2dfb3BlcmFfY29uZmlnX25vX2NoZWNrX2luc3RhbGxfYXdnLnNoICYmIGNobW9kICt4IC90bXAvYXdnX29wZXJhX2NvbmZpZ19ub19jaGVja19pbnN0YWxsX2F3Zy5zaCAmJiAvdG1wL2F3Z19vcGVyYV9jb25maWdfbm9fY2hlY2tfaW5zdGFsbF9hd2cuc2gKCQlicmVhawoJCTs7Cgk1KQoJCWVjaG8gIlJ1bm5pZyBzY3JpcHQgdW5pdmVyc2FsX2NvbmZpZy4uLiIKCQl3Z2V0IC0tbm8tY2hlY2stY2VydGlmaWNhdGUgLU8gL3RtcC91bml2ZXJzYWxfY29uZmlnLnNoIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Db2RlUm9LNy9PcGVuV1JUX2NvbmZpZ3MvcmVmcy9oZWFkcy9tYWluL3VuaXZlcnNhbF9jb25maWcuc2ggJiYgY2htb2QgK3ggL3RtcC91bml2ZXJzYWxfY29uZmlnLnNoICYmIC90bXAvdW5pdmVyc2FsX2NvbmZpZy5zaAoJCWJyZWFrCgkJOzsKCTYpCgkJZWNobyAiUnVubmlnIHNjcmlwdCB1bml2ZXJzYWxfY29uZmlnX25ldy4uLiIKCQl3Z2V0IC0tbm8tY2hlY2stY2VydGlmaWNhdGUgLU8gL3RtcC91bml2ZXJzYWxfY29uZmlnX25ldy5zaCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQ29kZVJvSzcvT3BlbldSVF9jb25maWdzL3JlZnMvaGVhZHMvbWFpbi91bml2ZXJzYWxfY29uZmlnX25ldy5zaCAmJiBjaG1vZCAreCAvdG1wL3VuaXZlcnNhbF9jb25maWdfbmV3LnNoICYmIC90bXAvdW5pdmVyc2FsX2NvbmZpZ19uZXcuc2gKCQlicmVhawoJCTs7Cgk3KQoJCWVjaG8gIlJ1bm5pZyBzY3JpcHQgdW5pdmVyc2FsX2NvbmZpZ19uZXdfcG9ka29wLi4uIgoJCXdnZXQgLS1uby1jaGVjay1jZXJ0aWZpY2F0ZSAtTyAvdG1wL3VuaXZlcnNhbF9jb25maWdfbmV3X3BvZGtvcC5zaCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQ29kZVJvSzcvT3BlbldSVF9jb25maWdzL3JlZnMvaGVhZHMvbWFpbi91bml2ZXJzYWxfY29uZmlnX25ld19wb2Rrb3Auc2ggJiYgY2htb2QgK3ggL3RtcC91bml2ZXJzYWxfY29uZmlnX25ld19wb2Rrb3Auc2ggJiYgL3RtcC91bml2ZXJzYWxfY29uZmlnX25ld19wb2Rrb3Auc2gKCQlicmVhawoJCTs7Cgk4KQoJCWVjaG8gIlJ1bm5pZyBzY3JpcHQgYXdnX2F1dG9fc2V0dXAuLi4iCgkJd2dldCAtLW5vLWNoZWNrLWNlcnRpZmljYXRlIC1PIC90bXAvYXdnX2F1dG9fc2V0dXAuc2ggaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0NvZGVSb0s3L09wZW5XUlRfY29uZmlncy9yZWZzL2hlYWRzL21haW4vYXdnX2F1dG9fc2V0dXAuc2ggJiYgY2htb2QgK3ggL3RtcC9hd2dfYXV0b19zZXR1cC5zaCAmJiAvdG1wL2F3Z19hdXRvX3NldHVwLnNoCgkJYnJlYWsKCQk7OwoJMCkKCQllY2hvICJHb29kYnkuLi4iCgkJYnJlYWsKCQk7OwoKCSopCgkJZWNobyAiUGxlYXNlIGVudGVyIDEgb3IgMiBvciAzIG9yIDQgb3IgNSBvciA2IG9yIDcgb3IgOCIKCQk7OwoJZXNhYwpkb25l"
eval "$(echo "$encoded_code" | base64 --decode)"
