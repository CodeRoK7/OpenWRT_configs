#!/bin/sh

checkPackageAndInstall()
{
    local name="$1"
    local isRequried="$2"
    #проверяем установлени ли библиотека $name
    if opkg list-installed | grep -q $name; then
        echo "$name already installed..."
    else
        echo "$name not installed. Installed $name..."
        opkg install $name
		res=$?
		if [ "$isRequried" = "1" ]; then
			if [ $res -eq 0 ]; then
				echo "$name insalled successfully"
			else
				echo "Error installing $name. Please, install $name manually and run the script again"
				exit 1
			fi
		fi
    fi
}

echo "opkg update"
opkg update

checkPackageAndInstall "coreutils-base64" "1"

encoded_code="IyEvYmluL3NoCgp3aGlsZSB0cnVlOyBkbwoJcHJpbnRmICJcMDMzWzMyOzFtQ2hvaWNlIHJ1biBzY3JpcHQsIDEgLSBjb25maWd1cmVfemFwcmV0cywgMiAtIGF3Z19jb25maWcsIDMgLSBhd2dfb3BlcmFfY29uZmlnLCA0IC0gYXdnX29wZXJhX2NvbmZpZ19ub19jaGVja19pbnN0YWxsX2F3ZywgNSAtIHVuaXZlcnNhbF9jb25maWcsIDYgLSB1bml2ZXJzYWxfY29uZmlnX25ldywgMCAtIGV4aXQ6IFwwMzNbMG0iCglyZWFkIGNob2ljZQoJY2FzZSAkY2hvaWNlIGluCgkxKQoJCWVjaG8gIlJ1bm5pZyBzY3JpcHQgY29uZmlndXJlX3phcHJldHMuLi4iCgkJd2dldCAtLW5vLWNoZWNrLWNlcnRpZmljYXRlIC1PIC90bXAvY29uZmlndXJlX3phcHJldHMuc2ggaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0NvZGVSb0s3L09wZW5XUlRfY29uZmlncy9yZWZzL2hlYWRzL21haW4vY29uZmlndXJlX3phcHJldHMuc2ggJiYgY2htb2QgK3ggL3RtcC9jb25maWd1cmVfemFwcmV0cy5zaCAmJiAvdG1wL2NvbmZpZ3VyZV96YXByZXRzLnNoCgkJYnJlYWsKCQk7OwoKCTIpCgkJZWNobyAiUnVubmlnIHNjcmlwdCBhd2dfY29uZmlnLi4uIgoJCXdnZXQgLS1uby1jaGVjay1jZXJ0aWZpY2F0ZSAtTyAvdG1wL2F3Z19jb25maWcuc2ggaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0NvZGVSb0s3L09wZW5XUlRfY29uZmlncy9yZWZzL2hlYWRzL21haW4vYXdnX2NvbmZpZy5zaCAmJiBjaG1vZCAreCAvdG1wL2F3Z19jb25maWcuc2ggJiYgL3RtcC9hd2dfY29uZmlnLnNoCgkJYnJlYWsKCQk7OwoJMykKCQllY2hvICJSdW5uaWcgc2NyaXB0IGF3Z19vcGVyYV9jb25maWcuLi4iCgkJd2dldCAtLW5vLWNoZWNrLWNlcnRpZmljYXRlIC1PIC90bXAvYXdnX29wZXJhX2NvbmZpZy5zaCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQ29kZVJvSzcvT3BlbldSVF9jb25maWdzL3JlZnMvaGVhZHMvbWFpbi9hd2dfb3BlcmFfY29uZmlnLnNoICYmIGNobW9kICt4IC90bXAvYXdnX29wZXJhX2NvbmZpZy5zaCAmJiAvdG1wL2F3Z19vcGVyYV9jb25maWcuc2gKCQlicmVhawoJCTs7Cgk0KQoJCWVjaG8gIlJ1bm5pZyBzY3JpcHQgYXdnX29wZXJhX2NvbmZpZy4uLiIKCQl3Z2V0IC0tbm8tY2hlY2stY2VydGlmaWNhdGUgLU8gL3RtcC9hd2dfb3BlcmFfY29uZmlnX25vX2NoZWNrX2luc3RhbGxfYXdnLnNoIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Db2RlUm9LNy9PcGVuV1JUX2NvbmZpZ3MvcmVmcy9oZWFkcy9tYWluL2F3Z19vcGVyYV9jb25maWdfbm9fY2hlY2tfaW5zdGFsbF9hd2cuc2ggJiYgY2htb2QgK3ggL3RtcC9hd2dfb3BlcmFfY29uZmlnX25vX2NoZWNrX2luc3RhbGxfYXdnLnNoICYmIC90bXAvYXdnX29wZXJhX2NvbmZpZ19ub19jaGVja19pbnN0YWxsX2F3Zy5zaAoJCWJyZWFrCgkJOzsKCTUpCgkJZWNobyAiUnVubmlnIHNjcmlwdCB1bml2ZXJzYWxfY29uZmlnLi4uIgoJCXdnZXQgLS1uby1jaGVjay1jZXJ0aWZpY2F0ZSAtTyAvdG1wL3VuaXZlcnNhbF9jb25maWcuc2ggaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0NvZGVSb0s3L09wZW5XUlRfY29uZmlncy9yZWZzL2hlYWRzL21haW4vdW5pdmVyc2FsX2NvbmZpZy5zaCAmJiBjaG1vZCAreCAvdG1wL3VuaXZlcnNhbF9jb25maWcuc2ggJiYgL3RtcC91bml2ZXJzYWxfY29uZmlnLnNoCgkJYnJlYWsKCQk7OwoJNikKCQllY2hvICJSdW5uaWcgc2NyaXB0IHVuaXZlcnNhbF9jb25maWdfbmV3Li4uIgoJCXdnZXQgLS1uby1jaGVjay1jZXJ0aWZpY2F0ZSAtTyAvdG1wL3VuaXZlcnNhbF9jb25maWdfbmV3LnNoIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Db2RlUm9LNy9PcGVuV1JUX2NvbmZpZ3MvcmVmcy9oZWFkcy9tYWluL3VuaXZlcnNhbF9jb25maWdfbmV3LnNoICYmIGNobW9kICt4IC90bXAvdW5pdmVyc2FsX2NvbmZpZ19uZXcuc2ggJiYgL3RtcC91bml2ZXJzYWxfY29uZmlnX25ldy5zaAoJCWJyZWFrCgkJOzsKCTApCgkJZWNobyAiR29vZGJ5Li4uIgoJCWJyZWFrCgkJOzsKCgkqKQoJCWVjaG8gIlBsZWFzZSBlbnRlciAxIG9yIDIgb3IgMyBvciA0IG9yIDUgb3IgNiIKCQk7OwoJZXNhYwpkb25l"
eval "$(echo "$encoded_code" | base64 --decode)"