#!/bin/sh

checkPackageAndInstall()
{
    local name="$1"
    local isRequried="$2"
    #проверяем установлени ли библиотека $name
    if opkg list-installed | grep -q $name; then
        echo "$name already installed..."
    else
        echo "$name not installed. Installed $name..."
        opkg install $name
		res=$?
		if [ "$isRequried" = "1" ]; then
			if [ $res -eq 0 ]; then
				echo "$name insalled successfully"
			else
				echo "Error installing $name. Please, install $name manually and run the script again"
				exit 1
			fi
		fi
    fi
}

echo "opkg update"
opkg update

checkPackageAndInstall "coreutils-base64" "1"

encoded_code="IyEvYmluL3NoCgp3aGlsZSB0cnVlOyBkbwoJcHJpbnRmICJcMDMzWzMyOzFtQ2hvaWNlIHJ1biBzY3JpcHQsIDEgLSBjb25maWd1cmVfemFwcmV0cywgMiAtIGF3Z19jb25maWcsIDMgLSBhd2dfb3BlcmFfY29uZmlnLCA0IC0gYXdnX29wZXJhX2NvbmZpZ19ub19jaGVja19pbnN0YWxsX2F3ZywgNSAtIHVuaXZlcnNhbF9jb25maWcsIDYgLSB1bml2ZXJzYWxfY29uZmlnX25ldywgNyAtIGF3Z19hdXRvX3NldHVwLCAwIC0gZXhpdDogXDAzM1swbSIKCXJlYWQgY2hvaWNlCgljYXNlICRjaG9pY2UgaW4KCTEpCgkJZWNobyAiUnVubmlnIHNjcmlwdCBjb25maWd1cmVfemFwcmV0cy4uLiIKCQl3Z2V0IC0tbm8tY2hlY2stY2VydGlmaWNhdGUgLU8gL3RtcC9jb25maWd1cmVfemFwcmV0cy5zaCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQ29kZVJvSzcvT3BlbldSVF9jb25maWdzL3JlZnMvaGVhZHMvbWFpbi9jb25maWd1cmVfemFwcmV0cy5zaCAmJiBjaG1vZCAreCAvdG1wL2NvbmZpZ3VyZV96YXByZXRzLnNoICYmIC90bXAvY29uZmlndXJlX3phcHJldHMuc2gKCQlicmVhawoJCTs7CgoJMikKCQllY2hvICJSdW5uaWcgc2NyaXB0IGF3Z19jb25maWcuLi4iCgkJd2dldCAtLW5vLWNoZWNrLWNlcnRpZmljYXRlIC1PIC90bXAvYXdnX2NvbmZpZy5zaCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQ29kZVJvSzcvT3BlbldSVF9jb25maWdzL3JlZnMvaGVhZHMvbWFpbi9hd2dfY29uZmlnLnNoICYmIGNobW9kICt4IC90bXAvYXdnX2NvbmZpZy5zaCAmJiAvdG1wL2F3Z19jb25maWcuc2gKCQlicmVhawoJCTs7CgkzKQoJCWVjaG8gIlJ1bm5pZyBzY3JpcHQgYXdnX29wZXJhX2NvbmZpZy4uLiIKCQl3Z2V0IC0tbm8tY2hlY2stY2VydGlmaWNhdGUgLU8gL3RtcC9hd2dfb3BlcmFfY29uZmlnLnNoIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Db2RlUm9LNy9PcGVuV1JUX2NvbmZpZ3MvcmVmcy9oZWFkcy9tYWluL2F3Z19vcGVyYV9jb25maWcuc2ggJiYgY2htb2QgK3ggL3RtcC9hd2dfb3BlcmFfY29uZmlnLnNoICYmIC90bXAvYXdnX29wZXJhX2NvbmZpZy5zaAoJCWJyZWFrCgkJOzsKCTQpCgkJZWNobyAiUnVubmlnIHNjcmlwdCBhd2dfb3BlcmFfY29uZmlnLi4uIgoJCXdnZXQgLS1uby1jaGVjay1jZXJ0aWZpY2F0ZSAtTyAvdG1wL2F3Z19vcGVyYV9jb25maWdfbm9fY2hlY2tfaW5zdGFsbF9hd2cuc2ggaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0NvZGVSb0s3L09wZW5XUlRfY29uZmlncy9yZWZzL2hlYWRzL21haW4vYXdnX29wZXJhX2NvbmZpZ19ub19jaGVja19pbnN0YWxsX2F3Zy5zaCAmJiBjaG1vZCAreCAvdG1wL2F3Z19vcGVyYV9jb25maWdfbm9fY2hlY2tfaW5zdGFsbF9hd2cuc2ggJiYgL3RtcC9hd2dfb3BlcmFfY29uZmlnX25vX2NoZWNrX2luc3RhbGxfYXdnLnNoCgkJYnJlYWsKCQk7OwoJNSkKCQllY2hvICJSdW5uaWcgc2NyaXB0IHVuaXZlcnNhbF9jb25maWcuLi4iCgkJd2dldCAtLW5vLWNoZWNrLWNlcnRpZmljYXRlIC1PIC90bXAvdW5pdmVyc2FsX2NvbmZpZy5zaCBodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vQ29kZVJvSzcvT3BlbldSVF9jb25maWdzL3JlZnMvaGVhZHMvbWFpbi91bml2ZXJzYWxfY29uZmlnLnNoICYmIGNobW9kICt4IC90bXAvdW5pdmVyc2FsX2NvbmZpZy5zaCAmJiAvdG1wL3VuaXZlcnNhbF9jb25maWcuc2gKCQlicmVhawoJCTs7Cgk2KQoJCWVjaG8gIlJ1bm5pZyBzY3JpcHQgdW5pdmVyc2FsX2NvbmZpZ19uZXcuLi4iCgkJd2dldCAtLW5vLWNoZWNrLWNlcnRpZmljYXRlIC1PIC90bXAvdW5pdmVyc2FsX2NvbmZpZ19uZXcuc2ggaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0NvZGVSb0s3L09wZW5XUlRfY29uZmlncy9yZWZzL2hlYWRzL21haW4vdW5pdmVyc2FsX2NvbmZpZ19uZXcuc2ggJiYgY2htb2QgK3ggL3RtcC91bml2ZXJzYWxfY29uZmlnX25ldy5zaCAmJiAvdG1wL3VuaXZlcnNhbF9jb25maWdfbmV3LnNoCgkJYnJlYWsKCQk7OwoJNykKCQllY2hvICJSdW5uaWcgc2NyaXB0IHVuaXZlcnNhbF9jb25maWdfbmV3X3BvZGtvcC4uLiIKCQl3Z2V0IC0tbm8tY2hlY2stY2VydGlmaWNhdGUgLU8gL3RtcC91bml2ZXJzYWxfY29uZmlnX25ld19wb2Rrb3Auc2ggaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL0NvZGVSb0s3L09wZW5XUlRfY29uZmlncy9yZWZzL2hlYWRzL21haW4vdW5pdmVyc2FsX2NvbmZpZ19uZXdfcG9ka29wLnNoICYmIGNobW9kICt4IC90bXAvdW5pdmVyc2FsX2NvbmZpZ19uZXdfcG9ka29wLnNoICYmIC90bXAvdW5pdmVyc2FsX2NvbmZpZ19uZXdfcG9ka29wLnNoCgkJYnJlYWsKCQk7OwoJOCkKCQllY2hvICJSdW5uaWcgc2NyaXB0IGF3Z19hdXRvX3NldHVwLi4uIgoJCXdnZXQgLS1uby1jaGVjay1jZXJ0aWZpY2F0ZSAtTyAvdG1wL2F3Z19hdXRvX3NldHVwLnNoIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9Db2RlUm9LNy9PcGVuV1JUX2NvbmZpZ3MvcmVmcy9oZWFkcy9tYWluL2F3Z19hdXRvX3NldHVwLnNoICYmIGNobW9kICt4IC90bXAvYXdnX2F1dG9fc2V0dXAuc2ggJiYgL3RtcC9hd2dfYXV0b19zZXR1cC5zaAoJCWJyZWFrCgkJOzsKCTApCgkJZWNobyAiR29vZGJ5Li4uIgoJCWJyZWFrCgkJOzsKCgkqKQoJCWVjaG8gIlBsZWFzZSBlbnRlciAxIG9yIDIgb3IgMyBvciA0IG9yIDUgb3IgNiBvciA3IG9yIDgiCgkJOzsKCWVzYWMKZG9uZQ=="
eval "$(echo "$encoded_code" | base64 --decode)"
